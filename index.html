<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyecto</title>
  <link rel="stylesheet" href="style1.css">
</head>
<body>

  <!-- ===== Login Page ===== -->
  <div class="login-page" id="login-page">
    <div class="login-box">
      <h2>Iniciar Sesi√≥n</h2>
      <button id="google-login">Iniciar con Google</button>
    </div>
  </div>

  <!-- ===== Main Page ===== -->
  <div class="main-page" id="main-page" style="display:none;">
    <header>
      <div class="logo">üåê Proyecto</div>
      <input type="text" class="search-bar" placeholder="Buscar...">
      <button class="menu-btn" id="open-menu">‚û§</button>
    </header>

    <!-- Foro -->
    <main>
      <section class="foro">
        <h2>Foro de Proyecto</h2>
        <form id="formulario-mensaje">
          <input type="text" id="mensaje" placeholder="Escribe un mensaje...">
          <button type="submit">Enviar</button>
        </form>
        <div id="mensajes"></div>
      </section>
    </main>
  </div>

  <!-- ===== Firebase + App ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // Configuraci√≥n Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDlvvtg68E7mEh71bwqX0YqWL31LTA4Q4A",
      authDomain: "i-s-a-foro-3bf2d.firebaseapp.com",
      projectId: "i-s-a-foro-3bf2d",
      storageBucket: "i-s-a-foro-3bf2d.firebasestorage.app",
      messagingSenderId: "413622307291",
      appId: "1:413622307291:web:c6654f75ff038d0ca8bffe",
      measurementId: "G-0HZ9B1SNWD"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // DOM
    const loginPage = document.getElementById("login-page");
    const mainPage = document.getElementById("main-page");
    const googleLogin = document.getElementById("google-login");

    // Login con Google
    googleLogin.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        console.error("Error en login:", err);
      }
    });

    // Detectar sesi√≥n
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginPage.style.display = "none";
        mainPage.style.display = "block";
        console.log("Bienvenido:", user.displayName);
      } else {
        loginPage.style.display = "flex";
        mainPage.style.display = "none";
      }
    });

    // ===== Firestore (mensajes) =====
    const mensajesRef = collection(db, "mensajes");
    const form = document.getElementById("formulario-mensaje");
    const input = document.getElementById("mensaje");
    const contenedor = document.getElementById("mensajes");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (input.value.trim() !== "" && auth.currentUser) {
        await addDoc(mensajesRef, {
          texto: input.value,
          fecha: new Date(),
          autor: auth.currentUser.displayName
        });
        input.value = "";
      }
    });

    const q = query(mensajesRef, orderBy("fecha"));
    onSnapshot(q, (snapshot) => {
      contenedor.innerHTML = "";
      snapshot.forEach((doc) => {
        let p = document.createElement("p");
        let data = doc.data();
        p.textContent = `${data.autor || "An√≥nimo"}: ${data.texto}`;
        contenedor.appendChild(p);
      });
    });
  </script>
</body>
</html>
